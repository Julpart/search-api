<?php
use Drupal\Core\Entity\EntityInterface;
use Drupal\Core\Queue\QueueFactory;
use Drupal\Core\Queue\QueueInterface;

/**
* Implements hook_entity_insert().
*/
function starwars_cron() {
  $result = \Drupal::service('starwars.sources');
  $queue_factory = \Drupal::service('queue');
  $queue = $queue_factory->get('cron_node');
  $apiUrl = $result->getUrl();
  $lastUpdateTime = \Drupal::state()->get('edit');
  foreach ($apiUrl as $key => $item) {
    $data = [
      'type' => $key,
      'url' => $item,
      'lastUpdate' => $lastUpdateTime,
    ];
    $queue->createItem($data);
  }
  \Drupal::state()->set('edit',$_SERVER['REQUEST_TIME']);
}



function starwars_form_alter(&$form, \Drupal\Core\Form\FormStateInterface $form_state, $form_id) {
  if($form_id == "contact_message_starwars_form_form"){
    $user = \Drupal\user\Entity\User::load(\Drupal::currentUser()->id());
    $form['field_name']['widget']['0']['#default_value'] = $user->field_name->value;
    $form['field_surname']['widget']['0']['#default_value'] = $user->field_surname->value;
  }
  if($form_id == "views_exposed_form"){
    $form['actions']['reset']['#access'] = TRUE;
  }
}

